<button onClick="runWithDebug()"> runWithDebug </button>
<button onClick="runWithoutDebug()"> runWithoutDebug </button>
<button onClick="runWithDebugLeakFixed()"> runWithDebugLeakFixed </button>

<script type="text/javascript">
  var locals = {
    fortunes: [
      {id: 0, message: "Additional fortune added at request time."},
      {id: 1, message: "Blurb"},
      {id: 2, message: "wat?"}
    ]
  };

  function runWithDebug() {
    for(var i = 0; i < 200000; i++) compiledWithDebug();
  }

  function runWithoutDebug() {
    for(var i = 0; i < 200000; i++) compiledWithoutDebug();
  }

  function runWithDebugLeakFixed() {
    for(var i = 0; i < 200000; i++) fixedMemoryLeak();
  }

  function compiledWithDebug() {
    var jade_debug = [{ lineno: 1, filename: "/home/andreas/code/sampleexpress/views/fortunes/index.jade" }];
    try {
    var buf = [];
    var jade_mixins = {};
    var jade_interp;
    ;var locals_for_with = (locals || {});(function (fortunes, undefined) {
    jade_debug.unshift({ lineno: 0, filename: "/home/andreas/code/sampleexpress/views/layout.jade" });
    jade_debug.unshift({ lineno: 1, filename: "/home/andreas/code/sampleexpress/views/layout.jade" });
    buf.push("<!DOCTYPE html>");
    jade_debug.shift();
    jade_debug.unshift({ lineno: 2, filename: "/home/andreas/code/sampleexpress/views/layout.jade" });
    buf.push("<html>");
    jade_debug.unshift({ lineno: undefined, filename: jade_debug[0].filename });
    jade_debug.unshift({ lineno: 3, filename: "/home/andreas/code/sampleexpress/views/layout.jade" });
    buf.push("<head>");
    jade_debug.unshift({ lineno: undefined, filename: jade_debug[0].filename });
    jade_debug.unshift({ lineno: 4, filename: "/home/andreas/code/sampleexpress/views/layout.jade" });
    buf.push("<title>");
    jade_debug.unshift({ lineno: undefined, filename: jade_debug[0].filename });
    jade_debug.unshift({ lineno: 4, filename: jade_debug[0].filename });
    buf.push("Fortunes");
    jade_debug.shift();
    jade_debug.shift();
    buf.push("</title>");
    jade_debug.shift();
    jade_debug.shift();
    buf.push("</head>");
    jade_debug.shift();
    jade_debug.unshift({ lineno: 5, filename: "/home/andreas/code/sampleexpress/views/layout.jade" });
    buf.push("<body>");
    jade_debug.unshift({ lineno: undefined, filename: jade_debug[0].filename });
    jade_debug.unshift({ lineno: 3, filename: "/home/andreas/code/sampleexpress/views/layout.jade" });
    jade_debug.unshift({ lineno: 4, filename: "/home/andreas/code/sampleexpress/views/fortunes/index.jade" });
    buf.push("<table>");
    jade_debug.unshift({ lineno: undefined, filename: jade_debug[0].filename });
    jade_debug.unshift({ lineno: 5, filename: "/home/andreas/code/sampleexpress/views/fortunes/index.jade" });
    buf.push("<tr>");
    jade_debug.unshift({ lineno: undefined, filename: jade_debug[0].filename });
    jade_debug.unshift({ lineno: 6, filename: "/home/andreas/code/sampleexpress/views/fortunes/index.jade" });
    buf.push("<th>");
    jade_debug.unshift({ lineno: undefined, filename: jade_debug[0].filename });
    jade_debug.unshift({ lineno: 6, filename: jade_debug[0].filename });
    buf.push("id");
    jade_debug.shift();
    jade_debug.shift();
    buf.push("</th>");
    jade_debug.shift();
    jade_debug.unshift({ lineno: 7, filename: "/home/andreas/code/sampleexpress/views/fortunes/index.jade" });
    buf.push("<th>");
    jade_debug.unshift({ lineno: undefined, filename: jade_debug[0].filename });
    jade_debug.unshift({ lineno: 7, filename: jade_debug[0].filename });
    buf.push("message");
    jade_debug.shift();
    jade_debug.shift();
    buf.push("</th>");
    jade_debug.shift();
    jade_debug.shift();
    buf.push("</tr>");
    jade_debug.shift();
    jade_debug.unshift({ lineno: 8, filename: "/home/andreas/code/sampleexpress/views/fortunes/index.jade" });
    // iterate fortunes
    ;(function(){
      var $$obj = fortunes;
      if ('number' == typeof $$obj.length) {

        for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {
          var fortune = $$obj[$index];

    jade_debug.unshift({ lineno: 8, filename: "/home/andreas/code/sampleexpress/views/fortunes/index.jade" });
    jade_debug.unshift({ lineno: 9, filename: "/home/andreas/code/sampleexpress/views/fortunes/index.jade" });
    buf.push("<tr>");
    jade_debug.unshift({ lineno: undefined, filename: jade_debug[0].filename });
    jade_debug.unshift({ lineno: 10, filename: "/home/andreas/code/sampleexpress/views/fortunes/index.jade" });
    buf.push("<td>" + (jade.escape(null == (jade_interp = fortune.id) ? "" : jade_interp)));
    jade_debug.unshift({ lineno: undefined, filename: jade_debug[0].filename });
    jade_debug.shift();
    buf.push("</td>");
    jade_debug.shift();
    jade_debug.unshift({ lineno: 11, filename: "/home/andreas/code/sampleexpress/views/fortunes/index.jade" });
    buf.push("<td>" + (jade.escape(null == (jade_interp = fortune.message) ? "" : jade_interp)));
    jade_debug.unshift({ lineno: undefined, filename: jade_debug[0].filename });
    jade_debug.shift();
    buf.push("</td>");
    jade_debug.shift();
    jade_debug.shift();
    buf.push("</tr>");
    jade_debug.shift();
    jade_debug.shift();
        }

      } else {
        var $$l = 0;
        for (var $index in $$obj) {
          $$l++;      var fortune = $$obj[$index];

    jade_debug.unshift({ lineno: 8, filename: "/home/andreas/code/sampleexpress/views/fortunes/index.jade" });
    jade_debug.unshift({ lineno: 9, filename: "/home/andreas/code/sampleexpress/views/fortunes/index.jade" });
    buf.push("<tr>");
    jade_debug.unshift({ lineno: undefined, filename: jade_debug[0].filename });
    jade_debug.unshift({ lineno: 10, filename: "/home/andreas/code/sampleexpress/views/fortunes/index.jade" });
    buf.push("<td>" + (jade.escape(null == (jade_interp = fortune.id) ? "" : jade_interp)));
    jade_debug.unshift({ lineno: undefined, filename: jade_debug[0].filename });
    jade_debug.shift();
    buf.push("</td>");
    jade_debug.shift();
    jade_debug.unshift({ lineno: 11, filename: "/home/andreas/code/sampleexpress/views/fortunes/index.jade" });
    buf.push("<td>" + (jade.escape(null == (jade_interp = fortune.message) ? "" : jade_interp)));
    jade_debug.unshift({ lineno: undefined, filename: jade_debug[0].filename });
    jade_debug.shift();
    buf.push("</td>");
    jade_debug.shift();
    jade_debug.shift();
    buf.push("</tr>");
    jade_debug.shift();
    jade_debug.shift();
        }

      }
    }).call(this);

    jade_debug.shift();
    jade_debug.shift();
    buf.push("</table>");
    jade_debug.shift();
    jade_debug.shift();
    jade_debug.shift();
    buf.push("</body>");
    jade_debug.shift();
    jade_debug.shift();
    buf.push("</html>");
    jade_debug.shift();
    jade_debug.shift();}.call(this,"fortunes" in locals_for_with?locals_for_with.fortunes:typeof fortunes!=="undefined"?fortunes:undefined,"undefined" in locals_for_with?locals_for_with.undefined:typeof undefined!=="undefined"?undefined:undefined));;return buf.join("");
    } catch (err) {
      jade.rethrow(err, jade_debug[0].filename, jade_debug[0].lineno,"extends ../layout\n\nblock content\n  table\n    tr\n      th id\n      th message\n    for fortune in fortunes\n      tr\n        td= fortune.id\n        td= fortune.message\n");
    }
  }

  function compiledWithoutDebug() {
    var buf = [];
    var jade_mixins = {};
    var jade_interp;
    ;var locals_for_with = (locals || {});(function (fortunes, undefined) {
    buf.push("<!DOCTYPE html><html><head><title>Fortunes</title></head><body><table><tr><th>id</th><th>message</th></tr>");
    // iterate fortunes
    ;(function(){
      var $$obj = fortunes;
      if ('number' == typeof $$obj.length) {

        for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {
          var fortune = $$obj[$index];

    buf.push("<tr><td>" + (jade.escape(null == (jade_interp = fortune.id) ? "" : jade_interp)) + "</td><td>" + (jade.escape(null == (jade_interp = fortune.message) ? "" : jade_interp)) + "</td></tr>");
        }

      } else {
        var $$l = 0;
        for (var $index in $$obj) {
          $$l++;      var fortune = $$obj[$index];

    buf.push("<tr><td>" + (jade.escape(null == (jade_interp = fortune.id) ? "" : jade_interp)) + "</td><td>" + (jade.escape(null == (jade_interp = fortune.message) ? "" : jade_interp)) + "</td></tr>");
        }

      }
    }).call(this);

    buf.push("</table></body></html>");}.call(this,"fortunes" in locals_for_with?locals_for_with.fortunes:typeof fortunes!=="undefined"?fortunes:undefined,"undefined" in locals_for_with?locals_for_with.undefined:typeof undefined!=="undefined"?undefined:undefined));;return buf.join("");
  }

  function DebugItem(lineno, filename) {
    this.lineno = lineno;
    this.filename = filename;
  }

  function fixedMemoryLeak() {
    var jade_debug = [new DebugItem(1, "/home/andreas/code/sampleexpress/views/fortunes/index.jade")];
    try {
    var buf = [];
    var jade_mixins = {};
    var jade_interp;
    ;var locals_for_with = (locals || {});(function (fortunes, undefined) {
    jade_debug.unshift(new DebugItem(0, "/home/andreas/code/sampleexpress/views/layout.jade"));
    jade_debug.unshift(new DebugItem(1, "/home/andreas/code/sampleexpress/views/layout.jade"));
    buf.push("<!DOCTYPE html>");
    jade_debug.shift();
    jade_debug.unshift(new DebugItem(2, "/home/andreas/code/sampleexpress/views/layout.jade"));
    buf.push("<html>");
    jade_debug.unshift(new DebugItem(undefined, jade_debug[0].filename));
    jade_debug.unshift(new DebugItem(3, "/home/andreas/code/sampleexpress/views/layout.jade"));
    buf.push("<head>");
    jade_debug.unshift(new DebugItem(undefined, jade_debug[0].filename));
    jade_debug.unshift(new DebugItem(4, "/home/andreas/code/sampleexpress/views/layout.jade"));
    buf.push("<title>");
    jade_debug.unshift(new DebugItem(undefined, jade_debug[0].filename));
    jade_debug.unshift(new DebugItem(4, jade_debug[0].filename));
    buf.push("Fortunes");
    jade_debug.shift();
    jade_debug.shift();
    buf.push("</title>");
    jade_debug.shift();
    jade_debug.shift();
    buf.push("</head>");
    jade_debug.shift();
    jade_debug.unshift(new DebugItem(5, "/home/andreas/code/sampleexpress/views/layout.jade"));
    buf.push("<body>");
    jade_debug.unshift(new DebugItem(undefined, jade_debug[0].filename));
    jade_debug.unshift(new DebugItem(3, "/home/andreas/code/sampleexpress/views/layout.jade"));
    jade_debug.unshift(new DebugItem(4, "/home/andreas/code/sampleexpress/views/fortunes/index.jade"));
    buf.push("<table>");
    jade_debug.unshift(new DebugItem(undefined, jade_debug[0].filename));
    jade_debug.unshift(new DebugItem(5, "/home/andreas/code/sampleexpress/views/fortunes/index.jade"));
    buf.push("<tr>");
    jade_debug.unshift(new DebugItem(undefined, jade_debug[0].filename));
    jade_debug.unshift(new DebugItem(6, "/home/andreas/code/sampleexpress/views/fortunes/index.jade"));
    buf.push("<th>");
    jade_debug.unshift(new DebugItem(undefined, jade_debug[0].filename));
    jade_debug.unshift(new DebugItem(6, jade_debug[0].filename));
    buf.push("id");
    jade_debug.shift();
    jade_debug.shift();
    buf.push("</th>");
    jade_debug.shift();
    jade_debug.unshift(new DebugItem(7, "/home/andreas/code/sampleexpress/views/fortunes/index.jade"));
    buf.push("<th>");
    jade_debug.unshift(new DebugItem(undefined, jade_debug[0].filename));
    jade_debug.unshift(new DebugItem(7, jade_debug[0].filename));
    buf.push("message");
    jade_debug.shift();
    jade_debug.shift();
    buf.push("</th>");
    jade_debug.shift();
    jade_debug.shift();
    buf.push("</tr>");
    jade_debug.shift();
    jade_debug.unshift(new DebugItem(8, "/home/andreas/code/sampleexpress/views/fortunes/index.jade"));
    // iterate fortunes
    ;(function(){
      var $$obj = fortunes;
      if ('number' == typeof $$obj.length) {

        for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {
          var fortune = $$obj[$index];

    jade_debug.unshift(new DebugItem(8, "/home/andreas/code/sampleexpress/views/fortunes/index.jade"));
    jade_debug.unshift(new DebugItem(9, "/home/andreas/code/sampleexpress/views/fortunes/index.jade"));
    buf.push("<tr>");
    jade_debug.unshift(new DebugItem(undefined, jade_debug[0].filename));
    jade_debug.unshift(new DebugItem(10, "/home/andreas/code/sampleexpress/views/fortunes/index.jade"));
    buf.push("<td>" + (jade.escape(null == (jade_interp = fortune.id) ? "" : jade_interp)));
    jade_debug.unshift(new DebugItem(undefined, jade_debug[0].filename));
    jade_debug.shift();
    buf.push("</td>");
    jade_debug.shift();
    jade_debug.unshift(new DebugItem(11, "/home/andreas/code/sampleexpress/views/fortunes/index.jade"));
    buf.push("<td>" + (jade.escape(null == (jade_interp = fortune.message) ? "" : jade_interp)));
    jade_debug.unshift(new DebugItem(undefined, jade_debug[0].filename));
    jade_debug.shift();
    buf.push("</td>");
    jade_debug.shift();
    jade_debug.shift();
    buf.push("</tr>");
    jade_debug.shift();
    jade_debug.shift();
        }

      } else {
        var $$l = 0;
        for (var $index in $$obj) {
          $$l++;      var fortune = $$obj[$index];

    jade_debug.unshift(new DebugItem(8, "/home/andreas/code/sampleexpress/views/fortunes/index.jade"));
    jade_debug.unshift(new DebugItem(9, "/home/andreas/code/sampleexpress/views/fortunes/index.jade"));
    buf.push("<tr>");
    jade_debug.unshift(new DebugItem(undefined, jade_debug[0].filename));
    jade_debug.unshift(new DebugItem(10, "/home/andreas/code/sampleexpress/views/fortunes/index.jade"));
    buf.push("<td>" + (jade.escape(null == (jade_interp = fortune.id) ? "" : jade_interp)));
    jade_debug.unshift(new DebugItem(undefined, jade_debug[0].filename));
    jade_debug.shift();
    buf.push("</td>");
    jade_debug.shift();
    jade_debug.unshift(new DebugItem(11, "/home/andreas/code/sampleexpress/views/fortunes/index.jade"));
    buf.push("<td>" + (jade.escape(null == (jade_interp = fortune.message) ? "" : jade_interp)));
    jade_debug.unshift(new DebugItem(undefined, jade_debug[0].filename));
    jade_debug.shift();
    buf.push("</td>");
    jade_debug.shift();
    jade_debug.shift();
    buf.push("</tr>");
    jade_debug.shift();
    jade_debug.shift();
        }

      }
    }).call(this);

    jade_debug.shift();
    jade_debug.shift();
    buf.push("</table>");
    jade_debug.shift();
    jade_debug.shift();
    jade_debug.shift();
    buf.push("</body>");
    jade_debug.shift();
    jade_debug.shift();
    buf.push("</html>");
    jade_debug.shift();
    jade_debug.shift();
    }.call(this,"fortunes" in locals_for_with?locals_for_with.fortunes:typeof fortunes!=="undefined"?fortunes:undefined,"undefined" in locals_for_with?locals_for_with.undefined:typeof undefined!=="undefined"?undefined:undefined));;return buf.join("");
    } catch (err) {
      jade.rethrow(err, jade_debug[0].filename, jade_debug[0].lineno,"extends ../layout\n\nblock content\n  table\n    tr\n      th id\n      th message\n    for fortune in fortunes\n      tr\n        td= fortune.id\n        td= fortune.message\n");
    }
  }

  // Jade Runtime
  !function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.jade=e()}}(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
  'use strict';

  /**
   * Merge two attribute objects giving precedence
   * to values in object `b`. Classes are special-cased
   * allowing for arrays and merging/joining appropriately
   * resulting in a string.
   *
   * @param {Object} a
   * @param {Object} b
   * @return {Object} a
   * @api private
   */

  exports.merge = function merge(a, b) {
    if (arguments.length === 1) {
      var attrs = a[0];
      for (var i = 1; i < a.length; i++) {
        attrs = merge(attrs, a[i]);
      }
      return attrs;
    }
    var ac = a['class'];
    var bc = b['class'];

    if (ac || bc) {
      ac = ac || [];
      bc = bc || [];
      if (!Array.isArray(ac)) ac = [ac];
      if (!Array.isArray(bc)) bc = [bc];
      a['class'] = ac.concat(bc).filter(nulls);
    }

    for (var key in b) {
      if (key != 'class') {
        a[key] = b[key];
      }
    }

    return a;
  };

  /**
   * Filter null `val`s.
   *
   * @param {*} val
   * @return {Boolean}
   * @api private
   */

  function nulls(val) {
    return val != null && val !== '';
  }

  /**
   * join array as classes.
   *
   * @param {*} val
   * @return {String}
   */
  exports.joinClasses = joinClasses;
  function joinClasses(val) {
    return (Array.isArray(val) ? val.map(joinClasses) :
      (val && typeof val === 'object') ? Object.keys(val).filter(function (key) { return val[key]; }) :
      [val]).filter(nulls).join(' ');
  }

  /**
   * Render the given classes.
   *
   * @param {Array} classes
   * @param {Array.<Boolean>} escaped
   * @return {String}
   */
  exports.cls = function cls(classes, escaped) {
    var buf = [];
    for (var i = 0; i < classes.length; i++) {
      if (escaped && escaped[i]) {
        buf.push(exports.escape(joinClasses([classes[i]])));
      } else {
        buf.push(joinClasses(classes[i]));
      }
    }
    var text = joinClasses(buf);
    if (text.length) {
      return ' class="' + text + '"';
    } else {
      return '';
    }
  };


  exports.style = function (val) {
    if (val && typeof val === 'object') {
      return Object.keys(val).map(function (style) {
        return style + ':' + val[style];
      }).join(';');
    } else {
      return val;
    }
  };
  /**
   * Render the given attribute.
   *
   * @param {String} key
   * @param {String} val
   * @param {Boolean} escaped
   * @param {Boolean} terse
   * @return {String}
   */
  exports.attr = function attr(key, val, escaped, terse) {
    if (key === 'style') {
      val = exports.style(val);
    }
    if ('boolean' == typeof val || null == val) {
      if (val) {
        return ' ' + (terse ? key : key + '="' + key + '"');
      } else {
        return '';
      }
    } else if (0 == key.indexOf('data') && 'string' != typeof val) {
      if (JSON.stringify(val).indexOf('&') !== -1) {
        console.warn('Since Jade 2.0.0, ampersands (`&`) in data attributes ' +
                     'will be escaped to `&amp;`');
      };
      if (val && typeof val.toISOString === 'function') {
        console.warn('Jade will eliminate the double quotes around dates in ' +
                     'ISO form after 2.0.0');
      }
      return ' ' + key + "='" + JSON.stringify(val).replace(/'/g, '&apos;') + "'";
    } else if (escaped) {
      if (val && typeof val.toISOString === 'function') {
        console.warn('Jade will stringify dates in ISO form after 2.0.0');
      }
      return ' ' + key + '="' + exports.escape(val) + '"';
    } else {
      if (val && typeof val.toISOString === 'function') {
        console.warn('Jade will stringify dates in ISO form after 2.0.0');
      }
      return ' ' + key + '="' + val + '"';
    }
  };

  /**
   * Render the given attributes object.
   *
   * @param {Object} obj
   * @param {Object} escaped
   * @return {String}
   */
  exports.attrs = function attrs(obj, terse){
    var buf = [];

    var keys = Object.keys(obj);

    if (keys.length) {
      for (var i = 0; i < keys.length; ++i) {
        var key = keys[i]
          , val = obj[key];

        if ('class' == key) {
          if (val = joinClasses(val)) {
            buf.push(' ' + key + '="' + val + '"');
          }
        } else {
          buf.push(exports.attr(key, val, false, terse));
        }
      }
    }

    return buf.join('');
  };

  /**
   * Escape the given string of `html`.
   *
   * @param {String} html
   * @return {String}
   * @api private
   */

  exports.escape = function escape(html){
    var result = String(html)
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;')
      .replace(/"/g, '&quot;');
    if (result === '' + html) return html;
    else return result;
  };

  /**
   * Re-throw the given `err` in context to the
   * the jade in `filename` at the given `lineno`.
   *
   * @param {Error} err
   * @param {String} filename
   * @param {String} lineno
   * @api private
   */

  exports.rethrow = function rethrow(err, filename, lineno, str){
    if (!(err instanceof Error)) throw err;
    if ((typeof window != 'undefined' || !filename) && !str) {
      err.message += ' on line ' + lineno;
      throw err;
    }
    try {
      str = str || require('fs').readFileSync(filename, 'utf8')
    } catch (ex) {
      rethrow(err, null, lineno)
    }
    var context = 3
      , lines = str.split('\n')
      , start = Math.max(lineno - context, 0)
      , end = Math.min(lines.length, lineno + context);

    // Error context
    var context = lines.slice(start, end).map(function(line, i){
      var curr = i + start + 1;
      return (curr == lineno ? '  > ' : '    ')
        + curr
        + '| '
        + line;
    }).join('\n');

    // Alter exception message
    err.path = filename;
    err.message = (filename || 'Jade') + ':' + lineno
      + '\n' + context + '\n\n' + err.message;
    throw err;
  };

  },{"fs":2}],2:[function(require,module,exports){

  },{}]},{},[1])(1)
  });

</script>
